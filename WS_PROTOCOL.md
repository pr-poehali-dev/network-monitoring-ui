# –ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≠–ó–°

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **URL**: `wss://eprom.online:10008/`
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: WebSocket (WSS)

## –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### –ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä (–∑–∞–ø—Ä–æ—Å—ã)
```json
{
  "type": "request",
  "action": "getAllStations" | "getStationById" | "subscribeUpdates" | "unsubscribeUpdates",
  "data": { ... },
  "requestId": "req_1699999999_1"
}
```

### –°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç (–æ—Ç–≤–µ—Ç—ã)
```json
{
  "type": "response" | "update" | "error",
  "action": "getAllStations" | "getStationById" | "stationUpdate",
  "data": { ... },
  "requestId": "req_1699999999_1",
  "error": {
    "code": "ERROR_CODE",
    "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
  }
}
```

---

## 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π

### –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
```json
{
  "type": "request",
  "action": "getAllStations",
  "requestId": "req_1699999999_1"
}
```

#### –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```json
{
  "type": "request",
  "action": "getAllStations",
  "data": {
    "filters": {
      "region": "–ú–æ—Å–∫–≤–∞",
      "is_active": 1
    }
  },
  "requestId": "req_1699999999_2"
}
```

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
```json
{
  "type": "response",
  "action": "getAllStations",
  "requestId": "req_1699999999_1",
  "data": {
    "stations": [
      {
        "id": 1,
        "station_id": "EZS-001",
        "name": "–≠–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è",
        "ip_address": "192.168.1.10",
        "ssh_port": 22,
        "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 15",
        "region": "–ú–æ—Å–∫–≤–∞",
        "is_active": 1,
        "created_at": "2024-01-15T10:30:00.000Z",
        "lat": 55.7558,
        "lon": 37.6176
      }
    ],
    "total": 15
  }
}
```

---

## 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏

### –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
```json
{
  "type": "request",
  "action": "getStationById",
  "data": {
    "stationId": 1
  },
  "requestId": "req_1699999999_3"
}
```

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
```json
{
  "type": "response",
  "action": "getStationById",
  "requestId": "req_1699999999_3",
  "data": {
    "station": {
      "id": 1,
      "station_id": "EZS-001",
      "name": "–≠–ó–° –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è",
      "ip_address": "192.168.1.10",
      "ssh_port": 22,
      "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 15",
      "region": "–ú–æ—Å–∫–≤–∞",
      "is_active": 1,
      "created_at": "2024-01-15T10:30:00.000Z",
      "lat": 55.7558,
      "lon": 37.6176
    }
  }
}
```

---

## 3. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
```json
{
  "type": "request",
  "action": "subscribeUpdates",
  "requestId": "req_1699999999_4"
}
```

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
```json
{
  "type": "response",
  "action": "subscribeUpdates",
  "requestId": "req_1699999999_4",
  "data": {
    "subscribed": true,
    "message": "Successfully subscribed to updates"
  }
}
```

### Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
–ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π:

```json
{
  "type": "update",
  "action": "stationUpdate",
  "data": {
    "stationId": 1,
    "updates": {
      "is_active": 0,
      "ip_address": "192.168.1.11"
    },
    "timestamp": "2024-11-09T15:30:45.123Z"
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏, –æ–±—ä–µ–¥–∏–Ω–∏–≤ `updates` —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## 4. –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ó–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–∞
```json
{
  "type": "request",
  "action": "unsubscribeUpdates",
  "requestId": "req_1699999999_5"
}
```

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
```json
{
  "type": "response",
  "action": "unsubscribeUpdates",
  "requestId": "req_1699999999_5",
  "data": {
    "unsubscribed": true,
    "message": "Successfully unsubscribed from updates"
  }
}
```

---

## 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å –æ—à–∏–±–∫–æ–π
```json
{
  "type": "error",
  "action": "getStationById",
  "requestId": "req_1699999999_6",
  "error": {
    "code": "STATION_NOT_FOUND",
    "message": "Station with ID 999 not found"
  }
}
```

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫
- `INVALID_REQUEST` - –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- `STATION_NOT_FOUND` - –°—Ç–∞–Ω—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `ALREADY_SUBSCRIBED` - –£–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `NOT_SUBSCRIBED` - –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `INTERNAL_ERROR` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `TIMEOUT` - –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–∏ (StationData)

```typescript
interface StationData {
  id: number;              // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID (autoincrement)
  station_id: string;       // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω—Ü–∏–∏
  name: string | null;      // –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
  ip_address: string | null; // IP –∞–¥—Ä–µ—Å
  ssh_port: number | null;   // SSH –ø–æ—Ä—Ç
  address: string | null;    // –§–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å
  region: string | null;     // –†–µ–≥–∏–æ–Ω
  is_active: number;         // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 1 = –∞–∫—Ç–∏–≤–Ω–∞, 0 = –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞
  created_at: string;        // ISO timestamp —Å–æ–∑–¥–∞–Ω–∏—è
  lat: number | null;        // –®–∏—Ä–æ—Ç–∞
  lon: number | null;        // –î–æ–ª–≥–æ—Ç–∞
}
```

---

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
1. –ö–ª–∏–µ–Ω—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å `wss://eprom.online:10008/`
2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏: `getAllStations`
3. –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: `subscribeUpdates`

### –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (–¥–æ 10 –ø–æ–ø—ã—Ç–æ–∫)
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏: 2 —Å–µ–∫—É–Ω–¥—ã √ó –Ω–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ö–ª–∏–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞ `update`
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞–Ω—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ –∏ –≤ —Å–ø–∏—Å–∫–µ —Å—Ç–∞–Ω—Ü–∏–π

---

## –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (JavaScript)

```javascript
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
const ws = new WebSocket('wss://eprom.online:10008/');

ws.onopen = () => {
  console.log('‚úÖ Connected to WebSocket');
  
  // –ó–∞–ø—Ä–æ—Å –≤—Å–µ—Ö —Å—Ç–∞–Ω—Ü–∏–π
  ws.send(JSON.stringify({
    type: 'request',
    action: 'getAllStations',
    requestId: 'req_' + Date.now()
  }));
};

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  
  if (message.type === 'response') {
    console.log('Response:', message.data);
  } else if (message.type === 'update') {
    console.log('Station update:', message.data);
    // –û–±–Ω–æ–≤–∏—Ç—å UI
  } else if (message.type === 'error') {
    console.error('Error:', message.error);
  }
};

ws.onerror = (error) => {
  console.error('‚ùå WebSocket error:', error);
};

ws.onclose = () => {
  console.log('üîå WebSocket disconnected');
  // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
};
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
websocat wss://eprom.online:10008/
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
```json
{"type":"request","action":"getAllStations","requestId":"test_1"}
```

### –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç
```json
{
  "type": "response",
  "action": "getAllStations",
  "requestId": "test_1",
  "data": {
    "stations": [...],
    "total": 15
  }
}
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

1. **–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω:**
   - –ü—Ä–∏–Ω–∏–º–∞—Ç—å WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–∞ `wss://eprom.online:10008/`
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å SSL/TLS (WSS)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å JSON —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É
   - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `requestId`
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –¢–∞–±–ª–∏—Ü–∞ `stations` —Å –ø–æ–ª—è–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `StationData`
   - SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
   - –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

3. **Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   - –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `update` –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL LISTEN/NOTIFY –∏–ª–∏ –∞–Ω–∞–ª–æ–≥

---

## Roadmap

### –§–∞–∑–∞ 1 (—Ç–µ–∫—É—â–∞—è) ‚úÖ
- –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω—Ü–∏–π
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç–µ

### –§–∞–∑–∞ 2 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞–Ω—Ü–∏—è–º (—ç–Ω–µ—Ä–≥–∏—è, —Å–µ—Å—Å–∏–∏)
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### –§–∞–∑–∞ 3 (–±—É–¥—É—â–µ–µ)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏—è–º–∏ (–≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ)
- –õ–æ–≥–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
